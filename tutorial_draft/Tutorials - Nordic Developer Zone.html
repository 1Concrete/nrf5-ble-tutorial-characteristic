<!DOCTYPE html>
<!-- saved from url=(0044)https://devzone.nordicsemi.com/tutorials/17/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Tutorials - Nordic Developer Zone</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=1024, initial-scale=0.5">
        <meta name="referrer" content="always">
        <link rel="shortcut icon" href="https://devzone.nordicsemi.com/static/favicon.ico">
        

        
<link rel="stylesheet" href="./Tutorials - Nordic Developer Zone_files/wmd.css">
<link rel="stylesheet" href="./Tutorials - Nordic Developer Zone_files/tutorials.css">

        <link href="./Tutorials - Nordic Developer Zone_files/bootstrap.css" rel="stylesheet" type="text/css">
        <link href="./Tutorials - Nordic Developer Zone_files/style.css" rel="stylesheet" type="text/css">
        <link href="./Tutorials - Nordic Developer Zone_files/common.css" rel="stylesheet" type="text/css">
        <link href="./Tutorials - Nordic Developer Zone_files/cms.css" rel="stylesheet" type="text/css">
    </head>
    <body class="admin">
        <header id="cmsheader">
            
            <div class="content-wrapper">
                <a href="https://devzone.nordicsemi.com/">
                    <img id="logo" src="./Tutorials - Nordic Developer Zone_files/logo.png" alt="Nordic Semiconductor Developer Zone">
                </a>
            </div>
        </header>
        <div id="menu">
            <div class="content-wrapper">
                <ul class="cmsmenu"> 
                    

<li class="sibling">
	<a href="https://devzone.nordicsemi.com/">Questions</a>
	
</li>

<li class="sibling">
	<a href="https://devzone.nordicsemi.com/blogs/">Blogs</a>
	
</li>

<li class="selected">
	<a href="https://devzone.nordicsemi.com/tutorials/">Tutorials</a>
	
</li>

<li class="sibling">
	<a href="https://devzone.nordicsemi.com/docs/">SDK and Documentation</a>
	
</li>

<li class="sibling">
	<a href="https://devzone.nordicsemi.com/tour/">Tour</a>
	
</li>

<li class="sibling">
	<a href="https://devzone.nordicsemi.com/about/">About </a>
	
</li>


                </ul>
                <ul class="linkmenu">
                    <li><a href="https://github.com/NordicSemiconductor">GitHub/Nordic</a></li>
                    <li><a href="https://www.nordicsemi.com/">nordicsemi.com</a></li>
                </ul>
            </div>
        </div>
        

        
<div id="secondaryHeader">
    <div class="content-wrapper">
        <div class="search-bar">
            <form action="https://devzone.nordicsemi.com/tutorials/search/" method="get">
                <div id="scopeNav">
                    <a class="scope-selector" href="https://devzone.nordicsemi.com/tutorials/all/">all</a>
                    
                </div>
                <div id="searchBar">
                    <input class="searchInput" type="text" autocomplete="off" value="" name="query" id="keywords" placeholder="search in tutorials...">
                    <input type="submit" value="" class="searchBtn">
                    <input type="button" value="X" class="cancelSearchBtn" style="display: none;">
                </div>
            </form>
        </div>
    </div>
</div>

        <div class="content-wrapper">
        
<div id="ContentLeft">
    
    
<script type="text/javascript" defer="" async="" src="./Tutorials - Nordic Developer Zone_files/piwik.js"></script><script async="" src="./Tutorials - Nordic Developer Zone_files/analytics.js"></script><script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/jquery-1.7.2.min.js" style="color: rgb(112, 112, 112);"></script>
<script type="text/javascript">
	$(document).ready(function(){
		$('#report_spam_tutorial_button').click(function(){
			if(confirm('Are you sure this is spam?')){
	            $.ajax({
		            type: "POST",
		            cache: false,
		            dataType: "json",
		            url: '/tutorials/17/report_spam/',
		            success: function(data) {
		            	$(location).attr('href',"/tutorials");
		            },
	        	});
	    	}
	    });
    });
</script>
<div class="actions">
    
        <a href="https://devzone.nordicsemi.com/tutorials/17/edit/" title="Edit this post">edit</a>
        <a href="https://devzone.nordicsemi.com/tutorials/17/delete/" title="Delete this post">delete</a>
    
</div>

<div class="tutorial-author">
    

<div class="user-card group-nordic-employees">
    <a class="avatar-box" href="https://devzone.nordicsemi.com/users/2056/martinbl/"><img class="gravatar" width="32" height="32" src="./Tutorials - Nordic Developer Zone_files/saved_resource" title="MartinBL" alt="MartinBL gravatar image"></a>
    <div class="user-info">
        <a href="https://devzone.nordicsemi.com/users/2056/martinbl/">Martin Børs-Lind</a>

        <br>
        
            Nordic employee<br>
        
        
        

        
        <span class="reputation-score">2831</span>
        

        
        <span class="badges" title="MartinBL has 4 silver badges and 3 bronze badges">
            
            
                <span class="badge2">●</span><span class="badgecount">4</span>
            
            
                <span class="badge3">●</span><span class="badgecount">3</span>
            
        </span>
        
    </div>
</div>
<p>Posted <abbr class="timeago" title="2015-09-04 12:49:25 +0100">Sep 4 '15</abbr></p>

</div>

<h1 class="tutorial-heading">BLE Characteristics, a beginner's tutorial</h1>

<p class="tutorial-preamble"><b><i>The purpose of this tutorial is to get you started with the basics of the nRF5x and Bluetooth Low Energy (BLE). More specifically we will go through the bare minimum of steps to get your first complete BLE application up and running. My goal in this tutorial is to have as little theory as possible, but still get you up and running with a “springboard” application. While doing this we will have a brief look at the attribute protocols, how services and characteristics are structured, and how it all looks in Master Control Panel. Hopefully it will be a fun way to get started with something functional, and maybe inspire you to go further with BLE. The tutorial is intended to be a natural continuation of the "BLE Services, a beginner's tutorial". </i></b></p>

<div class="tutorial meta">
    <ul class="tags">
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/102/" class="tag tag-right">master control panel</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/192/" class="tag tag-right">gatt</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/168/" class="tag tag-right">characteristic</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/419/" class="tag tag-right">notification</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/166/" class="tag tag-right">gap</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/41/" class="tag tag-right">cccd</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/502/" class="tag tag-right">mcp</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/562/" class="tag tag-right">service</a>
        </li>
        
        <li class="tag-left">
            <a href="https://devzone.nordicsemi.com/tutorials/tags/3853/" class="tag tag-right">tutorial</a>
        </li>
        
    </ul>
    <br>
</div>

<div class="tutorial page content">
    <p></p><h1>Before we begin</h1> <p></p>
<p></p><h3>Table of content</h3>
Topics that will be covered include: <p></p>
<ul><ol>
  <li>Before we begin</li>
  <li>Basic theory</li>
  <li>Attribute tables in Master Control Panel</li>
  <li>Description of the example</li>
  <li>Adding a characteristic</li>
  <li>Updating the characteristic and sending notifications</li>
</ol></ul><p></p><h3>Equipment and software</h3>
To complete this tutorial you will need the following:<p></p>
<ul><ul>
<li><a href="https://www.nordicsemi.com/eng/Products/nRF51-DK">nRF51 DK or nRF52 DK Development Kit</a>
</li><li><a href="https://www.nordicsemi.com/eng/Products/nRF51-Dongle">nRF51 Dongle</a>
</li><li>Keil V5.xx.
</li><li><a href="https://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822#Downloads">Master Control Panel (MCP)</a>. (You can also use the Master Control Panel found in the nRF Toolbox app for Android or the LightBlue app for iPhone)
</li><li><a href="https://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822#Downloads">nRFgo Studio</a>
</li><li><a href="http://developer.nordicsemi.com/nRF51_SDK/">SDK V11.0.0</a>.
</li><li>For nRF51 DK use SoftDevice <a href="https://www.nordicsemi.com/eng/nordic/Products/nRF51822/S130-SD-v2/53724">S130 V2.0.0</a> for nRF52 DK use <a href="https://www.nordicsemi.com/eng/nordic/Products/nRF52832/S132-SD-v2/51479">S132 V2.0.0</a>. 
</li><li>Example files found on github (There is also a branch you can look at with the final functioning code).
</li></ul></ul><p>Other kits, dongles and software versions might work as well, but this is what I have used. This tutorial will not cover how to install and setup the software.</p>
<p></p><h3>Necessary prior knowledge</h3>
This tutorial is intended to be a natural continuation of the <a href="https://devzone.nordicsemi.com/tutorials/8/ble-services-a-beginners-tutorial/">BLE Services, a beginner's tutorial</a> and <a href="https://devzone.nordicsemi.com/tutorials/5/">BLE Advertising, a beginner's tutorial</a>. It is recommended, but not necessary, to go through these tutorials first. It is expected that you have basic knowledge of how to use Keil, MCP, and nRFgo Studio. Read the tutorial <a href="https://devzone.nordicsemi.com/tutorials/2/setting-up-an-example-project-on-the-nrf51-dk/">Setting up an example project on the nRF51 DK</a> to learn how to use your equipment and compile your first BLE application. <p></p>
<p><strong>If you run into troubles please browse devzone, look for documentation on our <a href="http://infocenter.nordicsemi.com/index.jsp">Infocenter</a>, and read the user guides for your kits. I urge you to post any questions you might have on the forum and not below the tutorial. This makes it easier for other users and Nordic employees to see and search for your questions and you will actually most likely get a faster response(!).</strong></p>
<p></p><h1>Some basic theory</h1><p></p>
<p></p><h2>The Attribute Protocol and the Generic Attribute Profile</h2>
My goal in this tutorial is to have as little theory as possible, but still get you up and running with a “springboard” application. An application it is easy to customize and expand upon. Yet the Attribute Protocol (ATT) and Generic Attribute Profile (GATT) are so essential to BLE that there is no way around a brief introduction. Basic knowledge of the ATT and the GATT is useful later in this tutorial, although when you make simple applications and work with Nordic’s SoftDevices and SDKs these are not concepts you have to worry much about. You should be able to skip the theory and still complete the tutorial, but as mentioned we will refer to the following concepts as we go. <p></p>
<p></p><h2>Attribute Protocol (ATT)</h2>
As shown in the figure below the BLE protocol is built upon a number of layers. <p></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/7cf5f7696b49c5d884f089a24127b14c" alt="BLE Layer Model"></p>
<p>Notice how the application layer is right above the GATT which in turn is built upon the ATT. The ATT is based on a Client &lt;–&gt; Server relationship. The server holds information like sensor values, the state of a light switch, position data, etc. This information is organized in a table, referred to as an attribute table. Each attribute in the table is a value or piece of information with some associated properties.  So when a client wants the sensor data it refers to e.g. row 11 in the table. If it wants the state of the light switch it might refer to row 16, and so on. Here is an excerpt from the Bluetooth Core Specification V4.2 (Hereafter referred to as BCS):</p>
<p>Vol 3:, Part F, Ch. 2, “Protocol Overview”:</p>
<blockquote><p>The attribute protocol defines two
roles; a server role and a client
role. It allows a server to expose a
set of attributes to a client that are
accessible using the attribute
protocol. An attribute is a discrete
value that has the following three
properties associated with it: (1) an attribute type, defined by a UUID, (2) an attribute handle, (3) a set of permissions that are defined by each
higher layer specification that
utilizes the attribute; these
permissions cannot be accessed using
the Attribute Protocol. </p>
<p>The attribute
type specifies what the attribute
represents. Bluetooth SIG defined
attribute types are defined in the
Bluetooth SIG assigned numbers page,
and used by an associated higher layer
specification. Non-Bluetooth SIG
attribute types may also be defined.</p>

</blockquote><p>Let us relate this to a typical application, namely the Heart Rate Profile. In Table 1 each and every row is an attribute, and each attribute has a handle, a type, a set of permissions, and a value. </p>
<p><strong>Table 1:</strong></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/baec5e6f6cc1451bc67143d7a27b8da8" alt="HRS Attribute Table"></p>
<p></p><h3>Attribute Handles</h3>
The attribute handle uniquely identifies an attribute on a server, allowing a client to reference the attribute in read or write requests. To simplify things then handle can be considered as the row number in the attribute table. Although the handle number might not be sequential. The handles are 16-bit numbers and you will see later on that the SoftDevice use handles extensively to refer to various attributes. From a programmer’s perspective it is actually a quite effective way to pass values and information between functions. It makes it easy for your application to keep track of the attributes and to grab whatever information it needs. The handle numbers vary depending on how many attributes you have.<p></p>
<p></p><h3>Attribute Types (UUIDs)</h3>
A User Unique ID (UUID) is a 16 or 128-bit value used to identify the type of every attribute. In Table 1 there are five different types of attributes; one of type “Service Declaration” (0x2800), two of type “Characteristic Declaration” (0x2803), one of type “Heart Rate Measurement Characteristic Value” (0x2A37), one of type “Body Sensor Location Characteristic Value” (0x2A38), and finally one of type “Descriptor Declaration” (0x2902). Six attributes in total. There are more attribute types, and later on in the tutorial we will make our own.<p></p>
<p></p><h3>Attribute Permissions</h3>
Permissions define some rules of how you can interact with a specific attribute. It defines whether an attribute should be readable and/or writeable and what kind of authorization is required to do the operations. Note that these permissions only apply to the attribute value, not the handle, type, and the permission field itself. This allows a client to look through a server’s attribute table and discover what the server can provide. Although not necessarily read and write the values. <p></p>
<p></p><h3>Attribute Values</h3>
The value can be anything. It can be a heart rate value measured in beats per minute, the state of a light switch, or a string like “Hello World”. And sometimes it is information about where to find other attributes and their properties. For example, in the Service Declaration attribute in Table 1 (handle 0x000C) the value holds a UUID (0x180D) identifying what kind of service it is (notice the "Assigned Number" field almost at the top of <a href="https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.heart_rate.xml">this page</a>). The Characteristic Declaration value (handle 0x000D) holds information about the subsequent Characteristic Value Declaration (Properties, Handle, and Type). Finally, the Heart Rate Measurement Characteristic Value (handle 0x000E) eventually holds the actual number of heart beats per minute. <p></p>
<p></p><h2>The Generic Attribute Profile (GATT)</h2>
The concept of the GATT is to group attributes in an attribute table together in a very specific and logical order. The heart rate profile in Table 1 is an example of such a group. <p></p>
<p></p><h3>Service Declaration attribute</h3>
At the top of each group you always have a Service Declaration attribute. Its type is always 0x2800, the standard UUID for Service Declarations. Its handle depends on how many attributes are already present in the table. Its permissions are always Read Only without any authentication or authorization required. The value is another UUID defining what kind of service this is. In Table 1 the value is 0x180D, the Bluetooth SIG defined UUID for a Heart Rate Service. Later in the tutorial we will make our own attribute table with a service declaration containing our own custom UUID. <p></p>
<p></p><h3>Characteristic Declaration</h3>
Immediately after this follows a Characteristic Declaration (there is a rare exception to this rule, but that is out of scope for this tutorial). The Characteristic Declaration is similar to the Service Declaration. The type is always 0x2803, the standard UUID for Characteristic Declarations. And the permissions are always Read Only without any authentication or authorization required. The value however, contains some interesting data. It always contains a handle, a UUID, and a set of properties. These three elements describe the subsequent Characteristic Value Declaration. The handle naturally points to the Characteristic Value Declaration’s place in the attribute table.  The UUID describes what type of information or value we can expect to find in the Characteristic Value Declaration. For example, a temperature value, the state of a light switch, or some custom arbitrary value. And finally, the properties describe how the characteristic value can be interacted with. Table 2 shows the characteristic properties bit field. Don’t worry about understanding the details of the table now. We will circle back to it later. <p></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/16d234b77ddf2de6fb7455d3b11537a4" alt="Table of Properties"></p>
<p>Now you might wonder why we have read/write <em>permissions</em> for an attribute <em>and</em> read/write <em>properties</em> for the characteristic value. Shouldn’t they always be the same? And that is a legitimate question. The <em>properties</em> for the characteristic value are used in the GATT and application layers. However, they are actually only guidelines, or <em>clues</em> if you will, of what to expect from the Characteristic Value Declaration attribute. The <em>permissions</em> for the attribute (on the ATT layer) will always overrule the characteristic value properties (on the GATT layer). Now you might ask again “but why do we need both permissions and properties?”. And the simple, but disappointing, answer is: “Because the Bluetooth Core Specification says so”. It is confusing, but has implications for how we will set up our characteristic later so it needs to be said. </p>
<p></p><h3>Characteristic Value Declaration</h3>
After the Characteristic Declaration follows the Characteristic Value Declaration. This is the attribute that finally contains the actual value. And again, the value might be a temperature value, the state of a light switch, etc., etc. The Characteristic Value Declaration’s type is the same as specified in the Characteristic Declaration’s value field and the permissions are defined in the application layer (or us). <p></p>
<p></p><h3>Descriptor Declaration</h3>
After the Characteristic Value Declaration follows either <p></p>
<ol>
<li>a new Characteristic Declaration (there can be many characteristics grouped in a service).</li>
<li>a new Service Declaration (there can be many services in a table).</li>
<li>a Descriptor Declaration.</li>
</ol>
<p>In the case of the Heart Rate Measurement Characteristic in Table 1 the Characteristic Value Declaration is followed by a Descriptor Declaration. The descriptor is an attribute with additional information about the characteristic. There are several kinds of descriptors, but in this tutorial we will only deal with the Client Characteristic Configuration Descriptor (CCCD). More about this later.</p>
<p></p><h1>Attribute tables in Master Control Panel</h1>
Let us now compare what we just learned with the information displayed in MCP when we run the Heart Rate Service example from the SDK. After you have connected your device and ran a service discovery the MCP is actually showing the entire attribute table. Each line is an attribute and they are grouped in services and with characteristics as subgroups. The following screenshots show the data displayed in MCP when connected to my nRF51 DK board running the HRS example. <p></p>
<p><strong>Figure 1:</strong></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/9309664efd6ce3e0be2851aab0313e98" alt="Service Declaration"></p>
<p>In Figure 1 above I have marked the Service Declaration attribute. As you can see inside the red square the UUID of this attribute is 0x2800, the handle is 0x000C and the value is 0x180D (Least Significant Byte first (LSB) in the value field). This is exactly what we would expect after going through the attribute table in Table 1. The UUID shows that the attribute is a service declaration and the value shows that it is a Heart Rate Service. </p>
<p><strong>Figure 2:</strong></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/0f0c29065aacbe418585913ef8d433f6" alt="Characteristic Declaration"></p>
<p>In Figure 2 I have marked the first Characteristic Declaration attribute. As expected, the UUID is 0x2803 showing us that this is indeed a characteristic declaration. The value here is interesting. Although the meaning of the values is written in plain text to the right let's decode the value ourselves anyway. The value shown in the 'Value:' field is a number of bytes shown LSB first. To make it more readable we will reorder them to Most Significant Byte (MSB) first:
2A37-000E-10. You might already have noticed that 2A37 is the Heart Rate Measurement characteristic UUID and 000E is the handle identifying where this characteristic value declaration can be found in the attribute table. 0x10 is defining the properties. Comparing the value 0x10 to the bit field in Table 2 we can see that this represents Notification. So everything is still consistent with the attribute table in Table 1.</p>
<p><strong>Figure 3:</strong></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/65b9648d440b867e8a1c8ae661b9b275" alt="Characteristic"></p>
<p>In Figure 3 you can see that the characteristic value declaration's UUID is indeed 0x2A37 and the handle value is 0x000E, as specified in the characteristic declaration in Figure 2.</p>
<p><strong>Figure 4:</strong></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/ee2a02413227c9338d32a0fd1382f480" alt="CCCD"></p>
<p>Finally, in Figure 4 you can see the values of the CCCD attribute. You can see the predefined Descriptor UUID (0x2902) and that the value is 0x0000 This means that notification is currently switched off. More on this later. </p>
<p></p><h1>The example</h1>
It is time to get our hands dirty! I figured that as an example we will make a readable and writeable characteristic first. Then, after we have enjoyed manually reading and writing some data, we will include the temperature of the nRF5x's CPU core in the characteristic. In case you didn't know already the nRF5x actually has its own internal temperature sensor. It is not very accurate, but it is the simplest way for us to get started with some actual dynamic sensor values. Finally, we will enable notification to update the temperature values. 
First thing first: download the example code. To compile it, extract the example to "your_SDK_folder\examples\ble_peripheral". If you need help with this please have a look at this thread on devzone: <a href="https://devzone.nordicsemi.com/question/35068/compiling-github-projects/">Compiling github projects</a>. Open the project file and hit “Build”. It should compile without any errors and if you browse through the files you will see that it pretty much continues where the <a href="https://devzone.nordicsemi.com/tutorials/8/ble-services-a-beginners-tutorial/">service tutorial</a> ended. <p></p>
<p>The important files in this tutorial are <em>our_service.c</em>, <em>our_service.h</em>, and of course <em>main.c</em>. In these files you will find various comments beginning with:</p>
<pre class="prettyprint prettyprinted"><code><span class="com">// FROM_SERVICE_TUTORIAL:</span><span class="pln">
</span><span class="com">// ALREADY_DONE_FOR_YOU:</span><span class="pln">
</span><span class="com">// OUR_JOB: Step X.X</span></code></pre>
<p><em>FROM_SERVICE_TUTORIAL</em> means that this is code we looked at in the previous tutorial. A few places you will see <em>ALREADY_DONE_FOR_YOU</em>. This marks very basic code that I have already prepared for you so that we don't have to go through the less important stuff in detail. Finally, <em>OUR_JOB: Step X.X</em> indicates what and when things need to be done in the tutorial. </p>
<p></p><h2>To-do list</h2>
This is what needs to be done to get our characteristic up and running: <p></p>
<ol>
<li>Step 1: Add service. This was completed in the last tutorial when we made our own custom service with a custom base UUID and a service UUID. </li>
<li>Step 2: Declare and configure the characteristic. </li>
<li>Step 3: Add a CCCD to let the characteristic send notifications at regular intervals or whenever the temperature values are changing. </li>
</ol>
<p>This is what our attribute table should include to achieve all this:</p>
<p><strong>Table: 3</strong></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/6abd2f5c9ab2950a6c0172157e990830" alt="Our Attribute Table"></p>
<p></p><h2>Step 1: Add the service</h2>
As mentioned above this step was completed in the last tutorial, but let us take a quick look at what our work looks like in MCP so far. It should look something like this:<p></p>
<p><img src="./Tutorials - Nordic Developer Zone_files/f2f94be111c83aa76e3fe0d4267b2a13" alt="Service Declaration"></p>
<p>The highlighted line is the Service Declaration declaring our service. As you can see the attribute type is 0x2800, the attribute handle is 0x000C, and the attribute value is our 128-bit custom UUID. </p>
<p></p><h2>Step 2: Add the Characteristic</h2>
Calling the SoftDevice function <code>sd_ble_gatts_characteristic_add()</code> is our first goal. This function will add both the Characteristic Declaration and the Characteristic Value Declaration to our attribute table. However, in order to get there we have to do a few things first. <code>sd_ble_gatts_characteristic_add()</code> takes four parameters:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="lit">@param</span><span class="pun">[</span><span class="kwd">in</span><span class="pun">]</span><span class="pln">  </span><span class="typ">uint16_t</span><span class="pln">                        service_handle</span><span class="pun">.</span><span class="pln">
</span><span class="lit">@param</span><span class="pun">[</span><span class="kwd">in</span><span class="pun">]</span><span class="pln">  </span><span class="typ">ble_gatts_char_md_t</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">*</span><span class="pln">     p_char_md
</span><span class="lit">@param</span><span class="pun">[</span><span class="kwd">in</span><span class="pun">]</span><span class="pln">  </span><span class="typ">ble_gatts_attr_t</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">*</span><span class="pln">        p_attr_char_value
</span><span class="lit">@param</span><span class="pun">[</span><span class="kwd">out</span><span class="pun">]</span><span class="pln"> </span><span class="typ">ble_gatts_char_handles_t</span><span class="pln"> </span><span class="pun">*</span><span class="pln">      p_handles</span></code></pre>
<p>As you can see the function has three input parameters and one output parameter. The three input parameters need to be populated with details that will define the characteristic attributes. These parameters define the properties, read/write permissions, descriptors, characteristic values, etc. In fact, you have more than 70 properties at your disposal when you are defining your characteristic. It sounds daunting, but don't give up and throw away your dev kit just yet. Most of the parameters are optional and almost all of them work just fine if you initialize them to zero using <code>memset(&amp;parameter, 0, sizeof(parameter));</code>. Pretty neat! </p>
<p>We will start by populating only the essential parameters we need to get started. In fact, all we need to do is to choose where in memory to store the characteristic attributes and define a characteristic value type using our custom UUID. In the function <code>our_char_add()</code> I have already declared all the necessary variables for you and initialized them to zero. The order of which I have declared them might be a little confusing, but since the necessary parameters are nested into structures, and these structures might be nested into other structures, this is unfortunately the way it has to be. I have also selected names that might seem a little cryptic, but these are naming conventions used throughout the SDKs and I chose to go for consistency. </p>
<p>The three most important variables are:</p>
<ol>
<li><code>ble_gatts_attr_md_t attr_md</code>, The Attribute Metadata: This is a structure holding permissions and authorization levels required by characteristic value attributes. It also holds information on whether or not the characteristic value is of variable length and where in memory it is stored. </li>
<li><code>ble_gatts_char_md_t char_md</code>, The Characteristic Metadata: This is a structure holding the value properties of the characteristic value. It also holds metadata of the CCCD and possibly other kinds of descriptors. </li>
<li><code>ble_gatts_attr_t attr_char_value</code>, The Characteristic Value Attribute: This structure holds the actual value of the characteristic (like the temperature value). It also holds the maximum length of the value (it might e.g. be four bytes long) and it's UUID.</li>
</ol>
<p>So let's start populating the parameters. To make things a little easier I have tried to assign each step a number:</p>
<p></p><h3>Step 2.A, Use custom UUID to define characteristic value type</h3>
The characteristic will need its own UUID just as the service did. And in fact, we can add this the exact same way as we did with the service UUID. So type in the following at Step 2.A inside the  <code>our_char_add()</code> function: <p></p>
<pre class="prettyprint prettyprinted"><code><span class="typ">ble_uuid_t</span><span class="pln">          char_uuid</span><span class="pun">;</span><span class="pln">
</span><span class="typ">ble_uuid128_t</span><span class="pln">       base_uuid </span><span class="pun">=</span><span class="pln"> BLE_UUID_OUR_BASE_UUID</span><span class="pun">;</span><span class="pln">
char_uuid</span><span class="pun">.</span><span class="pln">uuid      </span><span class="pun">=</span><span class="pln"> BLE_UUID_OUR_CHARACTERISTC_UUID</span><span class="pun">;</span><span class="pln">
sd_ble_uuid_vs_add</span><span class="pun">(&amp;</span><span class="pln">base_uuid</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">char_uuid</span><span class="pun">.</span><span class="pln">type</span><span class="pun">);</span><span class="pln">
APP_ERROR_CHECK</span><span class="pun">(</span><span class="pln">err_code</span><span class="pun">);</span></code></pre>
<p>This will use the same base UUID as the service, but add a different 16-bit UUID for the characteristic. The UUID is defined as 0xBEEF in <em>our_service.h</em>. Note that this base UUID was added to the vendor specific table in the previous tutorial when we created the custom service. All subsequent calls with the same base UUID will return a reference to the same ID in the table. This way we will save some memory by not needing to store a large array of 128-bit long IDs.</p>
<p></p><h3>Step 2.B, Configure the Attribute Metadata</h3>
The following three lines are the bare minimum of what we need to describe the attributes of the characteristic. The only thing the lines do is to decide where in memory to store the attributes. We are going to store it in the SoftDevice (aka the stack) controlled part of memory and hence, we use <code>BLE_GATTS_VLOC_STACK</code>. The only other valid option is to use <code>BLE_GATTS_VLOC_USER</code> to store the attributes in the user controlled part of memory. <p></p>
<pre class="prettyprint prettyprinted"><code><span class="typ">ble_gatts_attr_md_t</span><span class="pln"> attr_md</span><span class="pun">;</span><span class="pln">
memset</span><span class="pun">(&amp;</span><span class="pln">attr_md</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">attr_md</span><span class="pun">));</span><span class="pln">
attr_md</span><span class="pun">.</span><span class="pln">vloc        </span><span class="pun">=</span><span class="pln"> BLE_GATTS_VLOC_STACK</span><span class="pun">;</span></code></pre>
<p>In the attribute metadata structure <code>ble_gatts_attr_md_t</code> you also have the option to define the permissions with associated authorization requirements. For example if you need Man In The Middle protection (MITM) or a passkey to access your attribute. We will circle back to this. </p>
<p></p><h3>Step 2.C, Configure the Characteristic Value Attribute</h3>
Now that we have made our self a new UUID and decided where to store the characteristic we will store this information in the Characteristic Value Attribute:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="typ">ble_gatts_attr_t</span><span class="pln">    attr_char_value</span><span class="pun">;</span><span class="pln">
memset</span><span class="pun">(&amp;</span><span class="pln">attr_char_value</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">attr_char_value</span><span class="pun">));</span><span class="pln">    
attr_char_value</span><span class="pun">.</span><span class="pln">p_uuid      </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">char_uuid</span><span class="pun">;</span><span class="pln">
attr_char_value</span><span class="pun">.</span><span class="pln">p_attr_md   </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">attr_md</span><span class="pun">;</span></code></pre>
<p></p><h3>Step 2.D, Add handles for the characteristic to our struct</h3>
We need to add a variable holding the relevant handles for our characteristic in our service structure. So head over to the <code>ble_os_t</code> definition in our_service.h and add the line shown below:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="typ">uint16_t</span><span class="pln">                    conn_handle</span><span class="pun">;</span><span class="pln"> 
    </span><span class="typ">uint16_t</span><span class="pln">                    service_handle</span><span class="pun">;</span><span class="pln">        
    </span><span class="com">// OUR_JOB: Step 2.D, Add handles for our characteristic</span><span class="pln">
    </span><span class="typ">ble_gatts_char_handles_t</span><span class="pln">    char_handles</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="typ">ble_os_t</span><span class="pun">;</span></code></pre>
<p>As you can see, the <code>ble_os_t</code> struct already has a field for the service declaration handle. The connection handle, <code>conn_handle</code>, is there to keep track of the current connection and don't really have anything to do with the attribute table handles. If you go to the definition of <code>ble_gatts_char_handles_t</code> you can see that our new variable can hold 16-bit handles for the characteristic value, user descriptor, its CCCD, and also something called Server Characteristic Configuration Descriptor (SCCD) which is not within the scope of this tutorial. </p>
<p></p><h3>Step 2.E, Add the new characteristic to the service</h3>
Then we are ready to add the new characteristic to our attribute table and it is as simple as this: <p></p>
<pre class="prettyprint prettyprinted"><code><span class="pln">err_code </span><span class="pun">=</span><span class="pln"> sd_ble_gatts_characteristic_add</span><span class="pun">(</span><span class="pln">p_our_service</span><span class="pun">-&gt;</span><span class="pln">service_handle</span><span class="pun">,</span><span class="pln">
                                   </span><span class="pun">&amp;</span><span class="pln">char_md</span><span class="pun">,</span><span class="pln">
                                   </span><span class="pun">&amp;</span><span class="pln">attr_char_value</span><span class="pun">,</span><span class="pln">
                                   </span><span class="pun">&amp;</span><span class="pln">p_our_service</span><span class="pun">-&gt;</span><span class="pln">char_handles</span><span class="pun">);</span><span class="pln">
APP_ERROR_CHECK</span><span class="pun">(</span><span class="pln">err_code</span><span class="pun">);</span></code></pre>
<p>As you can see, we are giving the SoftDevice information about what service the characteristic belongs to (the service_handle), the Characteristic Metadata, and the Characteristic Value Attributes. The stack then processes the parameters and initiates the characteristic. Then it stores the handle values of our characteristic into our p_our_serice structure.</p>
<p>Now compile and download your application to the kit. Make sure that you have remembered to program the SoftDevice to the kit as well. Open MCP, connect to your kit, and do a service discovery. You should see something like this:</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/5133d1ea279a4bc7ca7b189f6ca10906" alt="Minimal characteristic"></p>
<p>As you can see there is a new characteristic in our service, but it doesn't do anything useful at all. It has no value and you can neither read from it nor write to it. You can try for yourself by selecting the characteristic value line, type in some hexadecimal numbers in the "Value:" field, and hit the "Write" or "Read" button. MCP will send a write request or attempt a read, but since we have not defined any read or write permissions yet your kit will deny any read or write requests by default. This is what happens when we initialize the read/write attribute permissions to zero. The log window in MCP should show something like this:</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/82cd5d273775f55445251800811b15bf" alt="Read and write not permitted"></p>
<p></p><h3>Step 2.F, Add read/write properties to our characteristic value</h3>
To be able to read and write to the characteristic there are a couple of things we need to do. First go to Step 2.F in <code>our_char_add()</code> and add the following lines:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="typ">ble_gatts_char_md_t</span><span class="pln"> char_md</span><span class="pun">;</span><span class="pln">
memset</span><span class="pun">(&amp;</span><span class="pln">char_md</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">char_md</span><span class="pun">));</span><span class="pln">
char_md</span><span class="pun">.</span><span class="pln">char_props</span><span class="pun">.</span><span class="pln">read </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
char_md</span><span class="pun">.</span><span class="pln">char_props</span><span class="pun">.</span><span class="pln">write </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></pre>
<p>This will populate the characteristic metadata with read and write <em>properties</em>. Do another service discovery in MCP and note that the "Properties" field in the Characteristic Declaration has changed to "Read, Write":</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/c9e3d98dbe69159a055bb35519950bf9" alt="Read write properties"></p>
<p>Now try to read and write some values to the characteristic again.</p>
<p>But, wait, what is this?? You are still getting READ and WRITE_NOT_PERMITTED errors? </p>
<p>You should, if you have followed the tutorial to the letter so far. This is because what we just did was just setting the <em>properties</em> in the characteristic declaration and as discussed earlier they are just guidelines. So even though these properties are exposed when your MCP does a service discovery we have yet to set the <em>required permissions</em> for read and write operations. Before we have done this the SoftDevice doesn't know what to allow and simply denies any reads and writes of the characteristic. </p>
<p></p><h3>Step 2.G, Set read/write permissions to our characteristic</h3>
So let's add some read/write permissions. Since this is a beginners tutorial we will keep it simple and leave the doors wide open. No security, encryption, or passkey needed. A simple way of doing this is to use the macro <code>BLE_GAP_CONN_SEC_MODE_SET_OPEN()</code>. Go to Step 2.G in <code>our_char_add()</code> and add the following two lines:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="pln">BLE_GAP_CONN_SEC_MODE_SET_OPEN</span><span class="pun">(&amp;</span><span class="pln">attr_md</span><span class="pun">.</span><span class="pln">read_perm</span><span class="pun">);</span><span class="pln">
BLE_GAP_CONN_SEC_MODE_SET_OPEN</span><span class="pun">(&amp;</span><span class="pln">attr_md</span><span class="pun">.</span><span class="pln">write_perm</span><span class="pun">);</span></code></pre>
<p>Now do yet another service discovery and note how the word "Value: " is added to the characteristic value line in MCP:</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/d1fa63cbe0ce97c346f83dca57d46ce7" alt="Value field"></p>
<p>When you try to read from the characteristic now then this should pop up in the log window in MCP:</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/0146b529b3f0625de8d5b822fd25aa00" alt="Read attribute value"></p>
<p>Great success! We have just read 0, <em>zero(!)</em>, bytes from our new characteristic because we have not yet assigned a value or a value <em>length</em> to it.</p>
<p>Next, try to write e.g. the value 0x12 to the characteristic. You should get the following error because the value attribute length is initialized to zero:</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/2f3645d9db203d4012a5831fc82161b8" alt="Write attribute value"></p>
<p></p><h3>Step 2.H, Set characteristic length</h3>
So how do we fix the errors above? Go to Step 2.H and add the following lines:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="pln">attr_char_value</span><span class="pun">.</span><span class="pln">max_len     </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln">
attr_char_value</span><span class="pun">.</span><span class="pln">init_len    </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln">
</span><span class="typ">uint8_t</span><span class="pln"> value</span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln">            </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0x12</span><span class="pun">,</span><span class="lit">0x34</span><span class="pun">,</span><span class="lit">0x56</span><span class="pun">,</span><span class="lit">0x78</span><span class="pun">};</span><span class="pln">
attr_char_value</span><span class="pun">.</span><span class="pln">p_value     </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span></code></pre>
<p>This will set the initial length, and also the maximum allowed length, of the characteristic value to 4 bytes. And just to be a little thorough we will also set the initial value to 12-34-56-78. Once again, try to read from your characteristic and then write a couple of bytes. You should see that the value is updated. Even if you disconnect and reconnect the new value should be retained.</p>
<hr>
<p><strong>Challenge 1:</strong></p>
<ol>
<li>Try to write a single byte to the characteristic. E.g. '12'.</li>
<li>Try to write four bytes to the characteristic. E.g. '12-34-56-78'.</li>
<li>Try to write five or more bytes to the characteristic. E.g. '12-34-56-78-90'.</li>
</ol>
<p>What happens? Why are you not allowed to write more than four bytes to your characteristic and how can you fix it?</p>
<p><strong>Challenge 2:</strong></p>
<p>Try to experiment with the <code>attr_md</code> permissions and the following permission macros:</p>
<ol>
<li>BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS()</li>
<li>BLE_GAP_CONN_SEC_MODE_SET_OPEN()</li>
<li>BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM()</li>
</ol>
<p>Try to do some reads and writes. See what happens and watch out for error messages in the MCP log window. Hint on number 3: If you click "Bond" in MCP and bond with your kit you will automatically add encryption (ENC) to your BLE link. However, you are not required to use Man In The Middle (MITM) protection when bonding.</p>
<p></p><h2>Step 3: Client Characteristic Configuration Descriptor (CCCD)</h2>
So this is pretty cool, right? Not cool enough though. Let us add some dynamic temperature data, and while we are at it, let's also make our kit a little more independent and useful by making it periodically push data to our client. To achieve this we will need to: <p></p>
<ol>
<li>Add some sort of push functionality.</li>
<li>Do some housekeeping of our BLE connection and services.</li>
<li>Set up a timer to trigger the temperature updates. </li>
</ol>
<hr>
<p>The BCS defines two ways of "pushing" data: </p>
<p>Vol 3: Part G, Ch. 4.10 &amp; 4.11:</p>
<blockquote><p><strong>Indication</strong> - This sub-procedure is used when a
server is configured to indicate a
Characteristic Value to a client <em>and
expects an Attribute Protocol layer
acknowledgement</em> that the indication
was successfully received.</p>
<p><strong>Notification</strong> - This sub-procedure is used when a
server is configured to notify a
Characteristic Value to a client
<em>without expecting any Attribute
Protocol layer acknowledgment</em> that the
notification was successfully
received.</p>

</blockquote><p>The subtle, but important difference here is that by using indication your kit (the server) will require an application level acknowledgment in return after every transmission of updated data. By using notification, on the other hand, our kit will just "mindlessly" transmit data and not care about whether it is acknowledged by the application in the other end or not. So sticking to the "keep it simple"-philosophy of this tutorial we will use the latter. To add notification functionality we need to add a descriptor to our attribute table, namely the Client Characteristic Configuration Descriptor (CCCD). The BLE Core Specifications has the following to say about the CCCD:</p>
<p>Vol 3: Part G, Ch 3.3.3.3:  </p>
<blockquote><p>The Client Characteristic
Configuration declaration is an
optional characteristic descriptor
that defines how the characteristic
may be configured by a specific
client [...]</p>

</blockquote><p>What is written in between these cryptic lines is that the CCCD is a writable descriptor that allows <em>the client</em>, i.e. your MCP or phone, to enable or disable notification or indication, on your kit. </p>
<p></p><h3>Step 3.A, Configuring CCCD metadata</h3>
This is what we need to do to add the CCCD to our characteristic. <p></p>
<pre class="prettyprint prettyprinted"><code><span class="typ">ble_gatts_attr_md_t</span><span class="pln"> cccd_md</span><span class="pun">;</span><span class="pln">
memset</span><span class="pun">(&amp;</span><span class="pln">cccd_md</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">cccd_md</span><span class="pun">));</span><span class="pln">
BLE_GAP_CONN_SEC_MODE_SET_OPEN</span><span class="pun">(&amp;</span><span class="pln">cccd_md</span><span class="pun">.</span><span class="pln">read_perm</span><span class="pun">);</span><span class="pln">
BLE_GAP_CONN_SEC_MODE_SET_OPEN</span><span class="pun">(&amp;</span><span class="pln">cccd_md</span><span class="pun">.</span><span class="pln">write_perm</span><span class="pun">);</span><span class="pln">
cccd_md</span><span class="pun">.</span><span class="pln">vloc                </span><span class="pun">=</span><span class="pln"> BLE_GATTS_VLOC_STACK</span><span class="pun">;</span><span class="pln">    
char_md</span><span class="pun">.</span><span class="pln">p_cccd_md           </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">cccd_md</span><span class="pun">;</span><span class="pln">
char_md</span><span class="pun">.</span><span class="pln">char_props</span><span class="pun">.</span><span class="pln">notify   </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></pre>
<ol>
<li>We declare a metadata structure for the CCCD to hold our configuration.  </li>
<li>Using the same method as we did on the characteristic, we make sure that no security, encryption or passkeys are necessary to read or write to the CCCD.  </li>
<li>Also as we did with the characteristic, we decide where to store the descriptor, and once again we store it in the SoftDevice controlled part of memory.  </li>
<li>Then we store the CCCD metadata structure in our characteristic metadata structure.   </li>
<li>Enable notification by setting the notify property bit.</li>
</ol>
<p>Compile, download, run, and connect to your kit. Now you should be able to see the CCCD added to your characteristic:</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/11e3429b26b67141564c5b5b9f4aceea" alt="image description"></p>
<p>Notice also that "Notify" is added to the Characteristic Declaration's properties field. The UUID value of the CCCD is 0x2902 as we have seen earlier and the value is 0x0000 meaning that notification and indication is currently switched off. If you want you can enable notification right away, but since we have not yet set up any mechanisms updating the values nothing fancy will happen. Anyway, try to click the "Enable services" button. You should see that the value field of the CCCD is updated to 0x0001, meaning that notification is indeed enabled. You can also use the "Write" button and write to the CCCD manually.</p>
<p></p><h3>Step 3.B, Housekeeping part 1: Give our service connection handle a default value</h3>
In a simple example like ours housekeeping like this might actually not be necessary. However, it is crucial when developing slightly more advanced applications. Furthermore, since this sort of housekeeping is done in virtually every BLE examples in Nordic's SDKs I thought I would make an exception from our "keep it simple"-philosophy and show you how it can be done. <p></p>
<p>Our service structure, the <code>ble_os_t</code>, has a field called "conn_handle". This shall hold the handle of the current connection as provided by the BLE stack and we have to initialize it during system startup. Naturally, since we are not in a connection at system startup, the handle should be initialized to some "invalid" value. In the SDKs this value is defined as <code>BLE_CONN_HANDLE_INVALID</code> (with value 0xFFFF). So head over to the <code>our_service_init()</code> function in our_service.c and type in the following. </p>
<pre class="prettyprint prettyprinted"><code><span class="pln">p_our_service</span><span class="pun">-&gt;</span><span class="pln">conn_handle </span><span class="pun">=</span><span class="pln"> BLE_CONN_HANDLE_INVALID</span><span class="pun">;</span></code></pre>
<p></p><h3>Step 3.C, Housekeeping part 2: Responding to connect and disconnect events</h3>
In main.c there is a function called <code>ble_evt_dispatch()</code>. This function is called by the SoftDevice when a BLE stack event has occurs. To keep our service up to date with the latest connection events we will call <code>ble_our_service_on_ble_evt()</code> from the dispatch function:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="pln">ble_our_service_on_ble_evt</span><span class="pun">(&amp;</span><span class="pln">m_our_service</span><span class="pun">,</span><span class="pln"> p_ble_evt</span><span class="pun">);</span></code></pre>
<p></p><h3>Step 3.D, Housekeeping part 3: Handling BLE events related to our service</h3>
Go back to our_service.c and find the function <code>ble_our_service_on_ble_evt()</code>. Inside we will make a short switch case statement. In our example the only thing the statement will do is to update the connection handle stored in the service structure. On a connection event we will store the current connection handle as provided by the BLE stack. On a disconnect event we will set the handle back to "invalid".<p></p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_ble_evt</span><span class="pun">-&gt;</span><span class="pln">header</span><span class="pun">.</span><span class="pln">evt_id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> BLE_GAP_EVT_CONNECTED</span><span class="pun">:</span><span class="pln">
        p_our_service</span><span class="pun">-&gt;</span><span class="pln">conn_handle </span><span class="pun">=</span><span class="pln"> p_ble_evt</span><span class="pun">-&gt;</span><span class="pln">evt</span><span class="pun">.</span><span class="pln">gap_evt</span><span class="pun">.</span><span class="pln">conn_handle</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> BLE_GAP_EVT_DISCONNECTED</span><span class="pun">:</span><span class="pln">
        p_our_service</span><span class="pun">-&gt;</span><span class="pln">conn_handle </span><span class="pun">=</span><span class="pln"> BLE_CONN_HANDLE_INVALID</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">default</span><span class="pun">:</span><span class="pln">
        </span><span class="com">// No implementation needed.</span><span class="pln">
        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p></p><h3>Step 3.E, Update characteristic value</h3>
We are closing in on our goal. Now find the function <code>our_termperature_characteristic_update()</code>. This is where we will implement the notification. First implement an if-statement like this:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_our_service</span><span class="pun">-&gt;</span><span class="pln">conn_handle </span><span class="pun">!=</span><span class="pln"> BLE_CONN_HANDLE_INVALID</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">

</span><span class="pun">}</span></code></pre>
<p>Here we check whether or not we are in a valid connection, and this is where the housekeeping comes in handy. If you try to send out notifications when not in a connection the SoftDevice will get grumpy and give you errors. That is why we need this if-statement and why we implemented the housekeeping to keep the connection handle updated. Now, inside the if-statement type in the following:</p>
<pre class="prettyprint prettyprinted"><code><span class="typ">uint16_t</span><span class="pln">               len </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln">
</span><span class="typ">ble_gatts_hvx_params_t</span><span class="pln"> hvx_params</span><span class="pun">;</span><span class="pln">
memset</span><span class="pun">(&amp;</span><span class="pln">hvx_params</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">hvx_params</span><span class="pun">));</span><span class="pln">

hvx_params</span><span class="pun">.</span><span class="pln">handle </span><span class="pun">=</span><span class="pln"> p_our_service</span><span class="pun">-&gt;</span><span class="pln">char_handles</span><span class="pun">.</span><span class="pln">value_handle</span><span class="pun">;</span><span class="pln">
hvx_params</span><span class="pun">.</span><span class="pln">type   </span><span class="pun">=</span><span class="pln"> BLE_GATT_HVX_NOTIFICATION</span><span class="pun">;</span><span class="pln">
hvx_params</span><span class="pun">.</span><span class="pln">offset </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
hvx_params</span><span class="pun">.</span><span class="pln">p_len  </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">len</span><span class="pun">;</span><span class="pln">
hvx_params</span><span class="pun">.</span><span class="pln">p_data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">uint8_t</span><span class="pun">*)</span><span class="pln">characteristic_value</span><span class="pun">;</span><span class="pln">  

sd_ble_gatts_hvx</span><span class="pun">(</span><span class="pln">p_our_service</span><span class="pun">-&gt;</span><span class="pln">conn_handle</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">hvx_params</span><span class="pun">);</span></code></pre>
<p>First you might wonder what hvx stands for? It is not very intuitive, but it stands for Handle Value X, where X symbolize either notification or indication as the struct and function can be used for both. So to do a notification we declare a variable, <code>hvx_params</code>, of type <code>ble_gatts_hvx_params_t</code>. This will hold the necessary parameters to do a notification and provide them to the <code>sd_ble_gatts_hvx()</code> function. Here is what we will store in the variable:</p>
<ol>
<li><strong>handle:</strong> The SoftDevice needs to know what characteristic value we are working on. In applications with two or more characteristics naturally we will need to reference the handle of the specific characteristic value we want to use. Our example only has one characteristic and we will use the handle stored in <code>p_our_service-&gt;char_handles.value_handle</code>.</li>
<li><strong>type:</strong> The SoftDevice needs to know what "hvx type" we want to do; a notification or indication. As we are doing a notification we use <code>BLE_GATT_HVX_NOTIFICATION</code>. The other option would be <code>BLE_GATT_HVX_INDICATION</code>.</li>
<li><strong>offset:</strong> Your characteristic value might be a sequence of many bytes. If you want to transmit only a couple of these bytes and the bytes are located in the middle of the sequence you can use the offset to extract them. Since we want to update all of our four bytes we will set the offset to zero.</li>
<li><strong>p_len:</strong> The SoftDevice needs to know how many bytes to transmit. There is no need to send 20 bytes every time if you only have four bytes of relevant data. As an example, let's say you have a characteristic with the following sequence of bytes: 0x01, 0x02, 0x03, 0x04, 0x05 and you want to send just the 3rd and the 4th byte. Then set offset to 2 and len to 2. </li>
<li><strong>p_data:</strong> Here we add a pointer to the actual data. </li>
</ol>
<p>Finally we pass this structure into the <code>sd_ble_gatts_hvx()</code>. We also provide the function with the relevant connection handle. In some applications you might work with several concurrent connections and this is why the function also needs to know what handle to use. Now we have set up everything that has to do with the characteristic and notification. </p>
<p></p><h3>Step 3.F, Update the characteristic with temperature data</h3>
The rest is simply a matter of providing some data to send. We need to measure and collect the data we want to send and we need some mechanism to trigger each measurement. So jump into the function <code>timer_timeout_handler()</code> in main.c and type in the following:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="typ">int32_t</span><span class="pln"> temperature </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">   
sd_temp_get</span><span class="pun">(&amp;</span><span class="pln">temperature</span><span class="pun">);</span><span class="pln">
our_termperature_characteristic_update</span><span class="pun">(&amp;</span><span class="pln">m_our_service</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">temperature</span><span class="pun">);</span><span class="pln">
nrf_gpio_pin_toggle</span><span class="pun">(</span><span class="pln">LED_4</span><span class="pun">);</span></code></pre>
<ol>
<li><strong>temperature:</strong> We need a temporary variable to store the measured temperature.</li>
<li><strong>sd_temp_get():</strong> This is a very simple SoftDevice function that does everything for us. Just pass a pointer to our temperature variable and your measurements are done. </li>
<li><strong>our_termperature_characteristic_update():</strong> Make a call to the characteristic update function we made in Step 3.E and pass along a pointer to our service variable and the measured temperature. </li>
<li><strong>nrf_gpio_pin_toggle():</strong> Toggle LED 4 on the nRF5x DK kit just for show. </li>
</ol>
<p></p><h3>Step 3.G, Declare a timer ID and a timer interval</h3>
Not quite there yet. We need something to trigger the measurements. A trigger could for example be the push of a button or some command received from the client side. In our case though, we will use a timer to periodically measure the temperature. The first thing we need to do is defining the timer interval and we need a timer ID to identify this particular timer. So, locate Step 3.G somewhere at the top of main.c and type in the following:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="pln">APP_TIMER_DEF</span><span class="pun">(</span><span class="pln">m_our_char_timer_id</span><span class="pun">);</span><span class="pln">
</span><span class="com">#define</span><span class="pln"> OUR_CHAR_TIMER_INTERVAL     APP_TIMER_TICKS</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">,</span><span class="pln"> APP_TIMER_PRESCALER</span><span class="pun">)</span><span class="pln"> </span><span class="com">// 1000 ms intervals</span></code></pre>
<p>This will instantiate a timer ID variable and define a timer interval of 1000 ms.</p>
<p></p><h3>Step 3.H, Initiate the timer</h3>
To initialize our timer this is all we have to do:<p></p>
<pre class="prettyprint prettyprinted"><code><span class="pln">app_timer_create</span><span class="pun">(&amp;</span><span class="pln">m_our_char_timer_id</span><span class="pun">,</span><span class="pln"> APP_TIMER_MODE_REPEATED</span><span class="pun">,</span><span class="pln"> timer_timeout_handler</span><span class="pun">);</span></code></pre>
<p>We pass:</p>
<ol>
<li>Our timer ID</li>
<li>An enumeration called <code>APP_TIMER_MODE_REPEATED</code>. This tells the timer library to set up a timer that triggers at regular intervals. The other option is <code>APP_TIMER_MODE_SINGLE_SHOT</code> which sets up a timer that triggers only once. </li>
<li>A pointer to our timer timeout handler which is supposed to be executed on every timer event.</li>
</ol>
<p></p><h3>Step 3.I, Start our timer </h3>
Now it is time to start our engines! <p></p>
<p>Most often in Nordic's libraries the fact that a module is initiated does not mean that it is started, so we have to call one last function to reach our goal:</p>
<pre class="prettyprint prettyprinted"><code><span class="pln">app_timer_start</span><span class="pun">(</span><span class="pln">m_our_char_timer_id</span><span class="pun">,</span><span class="pln"> OUR_CHAR_TIMER_INTERVAL</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">);</span></code></pre>
<p>We pass:</p>
<ol>
<li>Our timer ID variable</li>
<li>Our defined timer interval</li>
<li>You have the option to pass a general purpose pointer that will be passed to the timeout handler when the timer expires. We won't bother with this so we will just ignore it and exercise our right to pass a simple <code>NULL</code>.</li>
</ol>
<p>Compile, download, connect, and discover services. Now to the moment of truth: Click "Enable services". If we have done everything right the characteristic value should update every second. 
You should see LED 4 and the value line in MCP blink green every second. You should also see values ticking in in the Log window in MCP like this:</p>
<p><img src="./Tutorials - Nordic Developer Zone_files/3b4d20604335a79549608b9be1ae8233" alt="image description"></p>
<p>If you now put your finger on the nRF51 chip you should also see that the values are changing. </p>
<hr>
<p><strong>Challenge 1:</strong></p>
<p>Try to alter <code>our_termperature_characteristic_update()</code> so that you only send a notification when the temperature has changed. Remember that BLE is all about saving energy so why spend resources on transmitting the same value over and over again?
Hint: Use a variable to store the current temperature value and compare it to the new one on the next measurement. </p>
<p><strong>Challenge 2:</strong></p>
<p>Try to modify the timer so that the temperature value is only measured when you are in a connection. I.e. start the timer on a connection event and stop it on a disconnect event. Why spend energy on measurements if you don't use them, right? Hint: Look for a timer start and stop function in the app_timer library. Then see if you can do some magic in the <code>on_ble_evt()</code> function in main.c.</p>
<hr>
<p></p><h1>Summary</h1>
Tadaa! You have now made a custom attribute table with a basic characteristic transmitting data from your server to your client. It is somewhat limited though, in the sense that it is only one way communication and it has no security or other advanced features. But I hope that I achieved my goal; that you gained at least some new knowledge and that the code is something you can expand upon. <p></p>
<p>Once again I urge you to post any questions you have in the Questions-section on the forum, not here. You will most likely get faster response that way. Positive or negative critique though is very welcome in the comment section below.</p>

</div>

<div class="comments">
    

<h2>5 comments</h2>

<div class="comment clearfix">
    <div class="comment-meta">
        

<div class="user-card ">
    <a class="avatar-box" href="https://devzone.nordicsemi.com/users/12159/wolfman24/"><img class="gravatar" width="32" height="32" src="./Tutorials - Nordic Developer Zone_files/nophoto.png" title="wolfman24" alt="wolfman24 gravatar image"></a>
    <div class="user-info">
        <a href="https://devzone.nordicsemi.com/users/12159/wolfman24/">wolfman24</a>

        <br>
        
        
        

        
        <span class="reputation-score">5</span>
        

        
        <span class="badges" title="wolfman24 has 3 silver badges and 2 bronze badges">
            
            
                <span class="badge2">●</span><span class="badgecount">3</span>
            
            
                <span class="badge3">●</span><span class="badgecount">2</span>
            
        </span>
        
    </div>
</div>
<p>Posted <abbr class="timeago" title="Dec. 5, 2015, 3:42 p.m.">Dec. 5, 2015, 3:42 p.m.</abbr></p>

    </div>
    <p>Hey Nordic! just wanted to say thanks for all the previews and tutorials, they have been a great big help on me trying to finish my project. I'm here on the characteristics aspect (obviously) and i understand the code for the most part just not really sure where it all goes. If you guys could post the code for this tutorial, even though i know you're still working on it, that would save me a lot of time. Thanks again!</p>


    
    <div class="comment-actions">
        <ul>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/?comment_id=161#comment-form">edit</a></li>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/comment/161/delete/">delete</a></li>
        </ul>
    </div>
    
</div>

<div class="comment clearfix">
    <div class="comment-meta">
        

<div class="user-card group-nordic-employees">
    <a class="avatar-box" href="https://devzone.nordicsemi.com/users/2056/martinbl/"><img class="gravatar" width="32" height="32" src="./Tutorials - Nordic Developer Zone_files/saved_resource" title="MartinBL" alt="MartinBL gravatar image"></a>
    <div class="user-info">
        <a href="https://devzone.nordicsemi.com/users/2056/martinbl/">Martin Børs-Lind</a>

        <br>
        
            Nordic employee<br>
        
        
        

        
        <span class="reputation-score">2831</span>
        

        
        <span class="badges" title="MartinBL has 4 silver badges and 3 bronze badges">
            
            
                <span class="badge2">●</span><span class="badgecount">4</span>
            
            
                <span class="badge3">●</span><span class="badgecount">3</span>
            
        </span>
        
    </div>
</div>
<p>Posted <abbr class="timeago" title="Jan. 25, 2016, 11:23 a.m.">Jan. 25, 2016, 11:23 a.m.</abbr></p>

    </div>
    <p>Preliminary project files <a href="https://github.com/Martinsbl/nrf51-ble-tutorial-characteristic">here</a>. </p>


    
    <div class="comment-actions">
        <ul>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/?comment_id=186#comment-form">edit</a></li>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/comment/186/delete/">delete</a></li>
        </ul>
    </div>
    
</div>

<div class="comment clearfix">
    <div class="comment-meta">
        

<div class="user-card ">
    <a class="avatar-box" href="https://devzone.nordicsemi.com/users/18279/travistsui/"><img class="gravatar" width="32" height="32" src="./Tutorials - Nordic Developer Zone_files/nophoto.png" title="Travistsui" alt="Travistsui gravatar image"></a>
    <div class="user-info">
        <a href="https://devzone.nordicsemi.com/users/18279/travistsui/">Travistsui</a>

        <br>
        
        
        

        
        <span class="reputation-score">1</span>
        

        
        <span class="badges" title="Travistsui has one silver badge">
            
            
                <span class="badge2">●</span><span class="badgecount">1</span>
            
            
        </span>
        
    </div>
</div>
<p>Posted <abbr class="timeago" title="March 11, 2016, 5:05 p.m.">March 11, 2016, 5:05 p.m.</abbr></p>

    </div>
    <p>Thanks Martin for this helpful characteristic tutorial!
I have question related to "Challenge 1:</p>
<p><em>Try to alter our_termperature_characteristic_update() so that you only send a notification when the temperature has changed. Remember that BLE is all about saving energy so why spend resources on transmitting the same value over and over again?"</em></p>
<p>I have tried few methods but it still did not work properly.
Can you help to solve the my problem?</p>


    
    <div class="comment-actions">
        <ul>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/?comment_id=224#comment-form">edit</a></li>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/comment/224/delete/">delete</a></li>
        </ul>
    </div>
    
</div>

<div class="comment clearfix">
    <div class="comment-meta">
        

<div class="user-card ">
    <a class="avatar-box" href="https://devzone.nordicsemi.com/users/10352/rph8/"><img class="gravatar" width="32" height="32" src="./Tutorials - Nordic Developer Zone_files/saved_resource(1)" title="rph8" alt="rph8 gravatar image"></a>
    <div class="user-info">
        <a href="https://devzone.nordicsemi.com/users/10352/rph8/">Raphael</a>

        <br>
        
        
        

        
        <span class="reputation-score">55</span>
        

        
        <span class="badges" title="rph8 has one gold badge, 6 silver badges and 8 bronze badges">
            
                <span class="badge1">●</span><span class="badgecount">1</span>
            
            
                <span class="badge2">●</span><span class="badgecount">6</span>
            
            
                <span class="badge3">●</span><span class="badgecount">8</span>
            
        </span>
        
    </div>
</div>
<p>Posted <abbr class="timeago" title="March 14, 2016, 10:56 p.m.">March 14, 2016, 10:56 p.m.</abbr></p>

    </div>
    <p>Another error?</p>
<p>I believe that sd_ble_uuid_vs_add should not be called again here after it was already called in the service setup. It caused a NRF_ERROR_NO_MEM in my code and leaving out the second call solves that problem.</p>


    
    <div class="comment-actions">
        <ul>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/?comment_id=231#comment-form">edit</a></li>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/comment/231/delete/">delete</a></li>
        </ul>
    </div>
    
</div>

<div class="comment clearfix">
    <div class="comment-meta">
        

<div class="user-card group-nordic-employees">
    <a class="avatar-box" href="https://devzone.nordicsemi.com/users/2056/martinbl/"><img class="gravatar" width="32" height="32" src="./Tutorials - Nordic Developer Zone_files/saved_resource" title="MartinBL" alt="MartinBL gravatar image"></a>
    <div class="user-info">
        <a href="https://devzone.nordicsemi.com/users/2056/martinbl/">Martin Børs-Lind</a>

        <br>
        
            Nordic employee<br>
        
        
        

        
        <span class="reputation-score">2831</span>
        

        
        <span class="badges" title="MartinBL has 4 silver badges and 3 bronze badges">
            
            
                <span class="badge2">●</span><span class="badgecount">4</span>
            
            
                <span class="badge3">●</span><span class="badgecount">3</span>
            
        </span>
        
    </div>
</div>
<p>Posted <abbr class="timeago" title="March 17, 2016, 1:51 p.m.">March 17, 2016, 1:51 p.m.</abbr></p>

    </div>
    <p>@Travistsui: You can do something like this:
    static int32_t previous_temperature_value = 0;</p>
<pre class="prettyprint prettyprinted"><code><span class="com">// If new temperature value is different from previous value then send notification</span><span class="pln">
</span><span class="kwd">if</span><span class="pun">(*</span><span class="pln">temperature_value </span><span class="pun">!=</span><span class="pln"> previous_temperature_value </span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="com">// Send value if connected and notifying</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_our_service</span><span class="pun">-&gt;</span><span class="pln">conn_handle </span><span class="pun">!=</span><span class="pln"> BLE_CONN_HANDLE_INVALID</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">uint16_t</span><span class="pln">               len </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln">
        </span><span class="typ">ble_gatts_hvx_params_t</span><span class="pln"> hvx_params</span><span class="pun">;</span><span class="pln">
        memset</span><span class="pun">(&amp;</span><span class="pln">hvx_params</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">hvx_params</span><span class="pun">));</span><span class="pln">

        hvx_params</span><span class="pun">.</span><span class="pln">handle </span><span class="pun">=</span><span class="pln"> p_our_service</span><span class="pun">-&gt;</span><span class="pln">char_handles</span><span class="pun">.</span><span class="pln">value_handle</span><span class="pun">;</span><span class="pln">
        hvx_params</span><span class="pun">.</span><span class="pln">type   </span><span class="pun">=</span><span class="pln"> BLE_GATT_HVX_NOTIFICATION</span><span class="pun">;</span><span class="pln">
        hvx_params</span><span class="pun">.</span><span class="pln">offset </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        hvx_params</span><span class="pun">.</span><span class="pln">p_len  </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">len</span><span class="pun">;</span><span class="pln">
        hvx_params</span><span class="pun">.</span><span class="pln">p_data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">uint8_t</span><span class="pun">*)</span><span class="pln">temperature_value</span><span class="pun">;</span><span class="pln">  

        sd_ble_gatts_hvx</span><span class="pun">(</span><span class="pln">p_our_service</span><span class="pun">-&gt;</span><span class="pln">conn_handle</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">hvx_params</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">  
</span><span class="pun">}</span><span class="pln">   

</span><span class="com">// Store current temperature value until next updated. </span><span class="pln">
previous_temperature_value </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="pln">temperature_value</span><span class="pun">;</span></code></pre>
<p>@Raphael: I believe this is a bug. At least it has been reported as such internally. However, sd_ble_uuid_vs_add() might not be intended to be called more than once. You can see e.g. in the ble_app_uart tutorial that it is only called once even though the UUID is reused. The returned uuid_type is then stored in the ble_nus_t service structure and passed around to where it is needed. I chose to call it twice instead for consistency in the code and to make the ble_os_t service structure as short as possible.
Anyway, I believe the bug is fixed in the new SDK 11 and S13x V2.0.0.</p>
<p><strong>PS:</strong> that the tutorial is not finished yet, and actually not supposed to be published. So the text might not be accurate, and the preliminary code is quite messy and continuously changing as I experiment with how to do things.</p>


    
    <div class="comment-actions">
        <ul>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/?comment_id=237#comment-form">edit</a></li>
            <li><a href="https://devzone.nordicsemi.com/tutorials/17/comment/237/delete/">delete</a></li>
        </ul>
    </div>
    
</div>


</div>

<div class="addcomment">

    
    <a name="comment-form">
    <form action="https://devzone.nordicsemi.com/tutorials/17/ble-characteristics-a-beginners-tutorial/" method="post"><input type="hidden" name="csrfmiddlewaretoken" value="QqiXUyL5R4Q4gwjK0aHw6yfTtnv3em5o">
        <input id="id_comment_id" name="comment_id" type="hidden">
        <div class="folded-editor unfolded">
            <div class="editor-proper">
                <div class="wmd-container">
                    <div id="wmd-button-bar" class="wmd-button-bar"><ul class="wmd-button-row" id="wmd-button-row"><li class="wmd-button wmd-bold-button" id="wmd-bold-button" title="bold &lt;strong&gt; Ctrl-B" style="background-position: 0px 0px;"></li><li class="wmd-button wmd-italic-button" id="wmd-italic-button" title="italic &lt;em&gt; Ctrl-I" style="background-position: -20px 0px;"></li><li class="wmd-spacer wmd-spacer1" id="wmd-spacer1"></li><li class="wmd-button wmd-link-button" id="wmd-link-button" title="link &lt;a&gt; Ctrl-L" style="background-position: -40px 0px;"></li><li class="wmd-button wmd-quote-button" id="wmd-quote-button" title="quote &lt;blockquote&gt; Ctrl-." style="background-position: -60px 0px;"></li><li class="wmd-button wmd-code-button" id="wmd-code-button" title="preformatted text &lt;pre&gt;&lt;code&gt; Ctrl-K" style="background-position: -80px 0px;"></li><li class="wmd-button wmd-image-button" id="wmd-image-button" title="image &lt;img&gt; Ctrl-G" style="background-position: -100px 0px;"></li><li class="wmd-button wmd-attachment-button" id="wmd-attachment-button" title="attachment Ctrl-F" style="background-position: -120px 0px;"></li><li class="wmd-spacer wmd-spacer2" id="wmd-spacer2"></li><li class="wmd-button wmd-olist-button" id="wmd-olist-button" title="numbered list &lt;ol&gt; Ctrl-O" style="background-position: -140px 0px;"></li><li class="wmd-button wmd-ulist-button" id="wmd-ulist-button" title="bulleted list &lt;ul&gt; Ctrl-U" style="background-position: -160px 0px;"></li><li class="wmd-button wmd-heading-button" id="wmd-heading-button" title="heading &lt;h1&gt;/&lt;h2&gt; Ctrl-H" style="background-position: -180px 0px;"></li><li class="wmd-button wmd-hr-button" id="wmd-hr-button" title="horizontal bar &lt;hr&gt; Ctrl-R" style="background-position: -200px 0px;"></li></ul></div>
                    <textarea id="editor" name="text"></textarea>
                </div>
            </div>
        </div>

        <div class="preview-toggle">
            <span id="pre-collapse" title="Toggle the real time Markdown editor preview">[hide preview]</span>
        </div>
        <div class="clearfix"></div>
        <div id="previewer" class="wmd-preview"></div>

        <input type="submit" value="Add comment">
    </form>
    
</a></div><a name="comment-form">

</a></div><a name="comment-form">
</a><div id="ContentRight"><a name="comment-form">
    
    
</a><div id="common-sidebar"><a name="comment-form">
</a><div id="user-menu" class="box"><a name="comment-form">
	
    <h2>User menu</h2>
    </a><ul><a name="comment-form">
    
        </a><li><a name="comment-form">
            

</a><div class="user-card group-nordic-employees"><a name="comment-form">
    </a><a class="avatar-box" href="https://devzone.nordicsemi.com/users/2056/martinbl/"><img class="gravatar" width="32" height="32" src="./Tutorials - Nordic Developer Zone_files/saved_resource" title="MartinBL" alt="MartinBL gravatar image"></a>
    <div class="user-info">
        <a href="https://devzone.nordicsemi.com/users/2056/martinbl/">Martin Børs-Lind</a>

        <br>
        
            Nordic employee<br>
        
        
        

        

        
    </div>
</div>
        </li>
        <li><a href="https://devzone.nordicsemi.com/messages/threads/">Private messages</a></li>
        <li><a href="https://devzone.nordicsemi.com/blogs/drafts/">Draft blog posts</a></li>
        <li><a href="https://devzone.nordicsemi.com/account/signout/?next=/account/logout/">Log out</a></li>
    
    </ul>
    <a href="http://www.nordicsemi.com/eng/About-us/Career"><img src="./Tutorials - Nordic Developer Zone_files/DevZone_Hiring_2015.png"></a>
</div>
<div class="box" id="recent-blog-posts">
    <h2>Recent blog posts</h2>
    <ul>
    
        <li><h3><a href="https://devzone.nordicsemi.com/blogs/880/deprecating-support-for-cmsis-pack-in-nrf5-sdk/">Deprecating support for CMSIS Pack in nRF5 SDK</a></h3>
            <span class="blog-meta">Posted <abbr class="timeago" title="2016-03-17 15:59:38">23 hours ago</abbr> by
                <a href="https://devzone.nordicsemi.com/users/9234/pucken/">Pär H</a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/blogs/879/production-release-of-nrf5-sdk-v110/">Production release of nRF5 SDK v11.0</a></h3>
            <span class="blog-meta">Posted <abbr class="timeago" title="2016-03-17 15:49:53">23 hours ago</abbr> by
                <a href="https://devzone.nordicsemi.com/users/9234/pucken/">Pär H</a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/blogs/877/monitor-mode-debugging-revolutionize-the-way-you-d/">Monitor Mode Debugging - Revolutionize the way you debug BLE applications</a></h3>
            <span class="blog-meta">Posted <abbr class="timeago" title="2016-03-15 11:36:25">Mar 15 '16</abbr> by
                <a href="https://devzone.nordicsemi.com/users/3582/mjdietz2/">Michael Dietz</a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/blogs/871/scope-your-bluetooth-rssi/">Scope your Bluetooth RSSI</a></h3>
            <span class="blog-meta">Posted <abbr class="timeago" title="2016-03-05 18:26:21">Mar 5 '16</abbr> by
                <a href="https://devzone.nordicsemi.com/users/1439/jason-liao/">Jason</a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/blogs/870/general-pcb-design-guidelines-for-nrf52/">General PCB design guidelines for nRF52</a></h3>
            <span class="blog-meta">Posted <abbr class="timeago" title="2016-03-09 14:08:51">Mar 9 '16</abbr> by
                <a href="https://devzone.nordicsemi.com/users/7135/fredriksundtbrynhildsvoll/">Fredrik Sundt Brynhildsvoll</a></span></li>
    
    </ul>
</div>
<div class="box" id="recent-questions">
    <h2>Recent questions</h2>
    <ul>
    
        <li><h3><a href="https://devzone.nordicsemi.com/question/72266/nrf52-pclk32m-32-mhz-peripheral-clock/">nRF52 PCLK32M - 32 MHz Peripheral Clock</a></h3>
            <span class="question-meta">Posted <abbr class="timeago" title="2016-03-18 13:16:45">2 hours ago</abbr> by
                <a href="https://devzone.nordicsemi.com/users/18528/h3rn/">hern16</a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/question/72259/how-could-i-reduce-power-consumption-after-using-nrf_timer1-with-softdevice/">How could I reduce power consumption after using NRF_TIMER1 with SoftDevice ?</a></h3>
            <span class="question-meta">Posted <abbr class="timeago" title="2016-03-18 12:33:14">3 hours ago</abbr> by
                <a href="https://devzone.nordicsemi.com/users/3813/forever9/">YG Ryu</a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/question/72254/is-any-ble-chipset-supports-audio-streaming/">Is any BLE chipset supports audio streaming?</a></h3>
            <span class="question-meta">Posted <abbr class="timeago" title="2016-03-18 11:38:31">4 hours ago</abbr> by
                <a href="https://devzone.nordicsemi.com/users/18525/mitulshinde/">Mitul </a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/question/72251/using-port-and-pin-events-simultaneously/">Using PORT and PIN events simultaneously</a></h3>
            <span class="question-meta">Posted <abbr class="timeago" title="2016-03-18 11:29:16">4 hours ago</abbr> by
                <a href="https://devzone.nordicsemi.com/users/11108/thangaraj/">Thangaraj</a></span></li>
    
        <li><h3><a href="https://devzone.nordicsemi.com/question/72250/two-channels-spi-on-nrf52/">two channels spi on nrf52</a></h3>
            <span class="question-meta">Posted <abbr class="timeago" title="2016-03-18 11:24:17">4 hours ago</abbr> by
                <a href="https://devzone.nordicsemi.com/users/9437/oliver/">oliverhu</a></span></li>
    
    </ul>
</div>
</div>

    

<div class="box">
    <h2>Your tutorial drafts</h2>
    
    <h3><a href="https://devzone.nordicsemi.com/tutorials/17/ble-characteristics-a-beginners-tutorial/">BLE Characteristics, a beginner's tutorial</a></h3>
    
</div>


<div class="box">
    <h2>Related posts by tag</h2>
    
    <div class="related">
        <h3><a href="https://devzone.nordicsemi.com/tutorials/8/ble-services-a-beginners-tutorial/">BLE Services, a beginner's tutorial</a></h3>
        <div class="userinfo">
    <time class="timeago" title="Aug. 26, 2015, 2:37 p.m.">Posted August 26th 2015</time> by
    <a href="https://devzone.nordicsemi.com/users/2056/martinbl/">Martin Børs-Lind</a>
</div>

    </div>
    
</div>

</div>

        </div>
        <!-- template footer.html -->
<div id="ground">
    <div class="content-wrapper">
        
        <div class="footer-links">
            <a href="https://devzone.nordicsemi.com/faq/">faq</a><span class="link-separator"> |</span>
            <a href="https://devzone.nordicsemi.com/terms">terms and conditions</a><span class="link-separator"> |</span>
            <a href="https://devzone.nordicsemi.com/feedback/?next=/tutorials/17/">
                        
                        give feedback
                    </a>
        </div>
        <div class="powered-link">
            <p>Follow Nordic on:</p>
            <ul class="clearfix">
                <li><a href="https://www.facebook.com/nordicsemiconductor"><img src="./Tutorials - Nordic Developer Zone_files/facebook.png"></a></li>
                <li><a href="https://twitter.com/NordicTweets"><img src="./Tutorials - Nordic Developer Zone_files/twitter.png"></a></li>
                <li><a href="http://www.linkedin.com/company/nordic-semiconductor-asa"><img src="./Tutorials - Nordic Developer Zone_files/linkedin.png"></a></li>
                <li><a href="http://www.youtube.com/user/NordicSemi"><img src="./Tutorials - Nordic Developer Zone_files/youtube.png"></a></li>
            </ul>
        </div>
        <div class="clean"></div>
    </div>
</div>
<!-- end template footer.html -->
        

        
<script src="./Tutorials - Nordic Developer Zone_files/saved_resource(2)"></script>
<script src="./Tutorials - Nordic Developer Zone_files/jquery-1.7.2.min.js"></script>
<script src="./Tutorials - Nordic Developer Zone_files/prettify.js"></script>
<script src="./Tutorials - Nordic Developer Zone_files/tutorials.js"></script>

<script type="text/javascript">
    var askbot = {};
    askbot['data'] = {};
    askbot['data']['userIsAuthenticated'] = true;
    askbot['data']['languageCode'] = 'en';
    
        askbot['data']['userId'] = 2056;
        askbot['data']['userName'] = 'MartinBL';
        askbot['data']['userIsAdminOrMod'] = true;
        askbot['data']['userIsAdmin'] = false;
        askbot['data']['userReputation'] = 2831;
        askbot['data']['userIsReadOnly'] = false;
    
    askbot['urls'] = {};
    askbot['settings'] = {};
    askbot['messages'] = {};

    askbot['urls']['get_tags_by_wildcard'] = '/get-tags-by-wildcard/';
    askbot['urls']['get_tag_list'] = '/get-tag-list/';
    askbot['urls']['follow_user'] = '/followit/follow/user//';
    askbot['urls']['unfollow_user'] = '/followit/unfollow/user//';
    askbot['urls']['user_signin'] = '/account/signin/';
    askbot['urls']['getEditor'] = '/get-editor/';
    askbot['urls']['apiGetQuestions'] = '/api/get_questions/';
    askbot['urls']['ask'] = '/questions/ask/';
    askbot['urls']['questions'] = '/questions/';
    askbot['settings']['static_url'] = '/static/';
    askbot['settings']['groupsEnabled'] = false;
    askbot['settings']['mathjaxEnabled'] = false;
    askbot['settings']['editorType'] = 'markdown';
    askbot['settings']['commentsEditorType'] = 'plain-text';
    askbot['settings']['allowedUploadFileTypes'] = ['*'];
</script>

<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/bootstrap.js"></script>
<!-- History.js -->
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/jquery.history.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/utils.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/live_search.js"></script>
<script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function(){
        // focus input on the search bar endcomment

        if (askbot['data']['userIsAdminOrMod']) {
            $('body').addClass('admin');
        }
        if (askbot['settings']['groupsEnabled']) {
            askbot['urls']['add_group'] = "/add-group/";
            var group_dropdown = new GroupDropdown();
            $('.dropdown').append(group_dropdown.getElement());
        }
        var userRep = $('#userToolsNav .reputation');
        if (userRep.length) {
            var showPermsTrigger = new ShowPermsTrigger();
            showPermsTrigger.decorate(userRep);
        }
    });
    $('abbr.timeago').timeago();
    /*]]>*/
</script>
<script type="text/javascript">
    
    askbot['settings']['tagsAreRequired'] = false
    askbot['settings']['maxTagLength'] = 30;
    askbot['messages']['maxTagLength'] = "each tag must be shorter than 30 characters";
    askbot['settings']['maxTagsPerPost'] = 10;
    askbot['messages']['maxTagsPerPost'] = "please use 10 tags or less";
    askbot['messages']['tagLimits'] = "please use up to 10 tags, less than 30 characters each";
    askbot['urls']['upload'] = '/upload/';
    askbot['settings']['minTitleLength'] = 10;
    askbot['settings']['minQuestionBodyLength'] = 10;
    askbot['settings']['minAnswerBodyLength'] = 10;
    askbot['settings']['minCommentBodyLength'] = 10;
    askbot['settings']['tag_editor'] = '';
    askbot['settings']['tinyMCEPlugins'] = JSON.parse('[]');
</script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/editor.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/jquery.validate.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/post.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/Markdown.Converter.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/Markdown.Sanitizer.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/askbot_converter.js"></script>
<script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/wmd.js"></script>
<script type="text/javascript">
    var codeFriendlyMarkdown = true;

    $().ready(function(){
        $('#id_text').TextAreaResizer();
        $('#id_text').typeWatch({highlight: false, wait: 3000,
                         captureLength: 5, callback: lanai.highlightSyntax});

        var display = true;
        var txt = "[hide preview]";
        $('#pre-collapse').text(txt);
        $('#pre-collapse').bind('click', function(){
            txt = display ? "[show preview]" : "[hide preview]";
            display = !display;
            $('#previewer').toggle();
            $('#pre-collapse').text(txt);
        });
        //Tags autocomplete

        var tagAc = new AutoCompleter({
                url: '/get-tag-list/',
                minChars: 1,
                useCache: true,
                matchInside: true,
                maxCacheLength: 100,
                delay: 10
        });
        tagAc.decorate($("#id_tags"));

        lanai.highlightSyntax();
    });
</script>


        <script src="./Tutorials - Nordic Developer Zone_files/saved_resource(2)"></script>
        <script type="text/javascript" src="./Tutorials - Nordic Developer Zone_files/utils(1).js"></script>
        <script type="text/javascript">
        $("abbr.timeago").timeago();
        </script>
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-69304823-1', 'devzone.nordicsemi.com');
  ga('send', 'pageview');

</script>
        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript>&lt;p&gt;&lt;img src="/piwik/piwik.php?idsite=1" style="border:0;" alt="" /&gt;&lt;/p&gt;</noscript>
<!-- End Piwik Code -->
    

<div class="acResults" style="display: none; position: absolute;"></div></body></html>